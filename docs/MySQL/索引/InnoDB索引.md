# InnoDB 索引

### 1. 结构
InnoDB 默认使用 B+ 树作为索引结构。

> 参考：[B+ 树](/docs/MySQL/索引/B+树.md)

### 2. 索引类型
1. 主键索引，主键索引的叶子节点存的是主键和整行数据。也称为聚簇索引。
2. 非主键索引，非主键索引的叶子节点存的是非主键的值 + 主键的值。也被称为二级索引、非聚簇索引。

#### 2. 基于主键索引和普通索引的查询有什么区别
- 如果 SQL 是 `select * from T where id = 500`，即主键查询方式，只需要查找主键索引对应的 B+ 树；
- 如果 SQL 是 `select * from T where k = 5`，即普通索引查询方式，需要先查找 k 字段对应的索引树，得到 id 的值为 500，再到主键索引树查找一次。这个过程称为**回表**。

#### B+ 树数据页
索引只能定位到 page，page 内部怎么去定位行数据？

B+ 树为了维护索引有序性，在插入、删除新值的时候需要做必要的维护。例如，
- 挪动数据；
- 页分裂：在数据之间进行插入，或者新增时新增数据页；
- 页合并：对数据进行删除，当相邻的两个数据页利用率很低的时候会做数据页合并。

B+ 树索引本身并不能找到具体的一条记录，只能找到该记录所在的页。数据库把页载入到内存中，通过 page directory（页目录）再进行二分法。(内部是个有序数组，二分法）

页与页之间是通过指针关联。


#### 自增主键的优势
1. 性能：每次插入一条新记录，都是追加操作，都不涉及到挪动其他记录，也不会触发叶子节点的分裂；
2. 存储空间：自增主键的占用 4 字节，主键长度越小，普通索引的叶子节点就越小，普通索引占用的空间也就越小。


### 3. 联合索引
#### 3.1 最左前缀原则
联合索引中索引项是按照索引定义里面出现的字段顺序排序的。

在建立联合索引的时候，如何安排索引内的字段顺序？
- 如果通过调整顺序，可以少维护一个索引，那么这个顺序往往就是需要优先考虑采用的 (最左)；
- 考虑的原则就是空间，索引的值越小越好。



### 名词汇总

| 名词 | 含义 |
| :-- | :-- |
| 聚簇索引 | 主键索引 |
| 非聚簇索引 | 非主键索引 |
| 回表 | 查询普通索引，获取主键之后，再查询主键索引，这个过程称为回表 |
| 覆盖索引 | 如果只查询主键的值，或者是某联合主键里的值，不需要进行回表，就称为覆盖索引 |